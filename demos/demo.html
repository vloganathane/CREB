<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CREB-JS Enhanced Demo with PubChem Integration</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üß™</text></svg>">
    <style>
        * {
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        /* Main Navigation Menu */
        .main-nav {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 0;
            margin: 0;
            box-shadow: 0 2px 20px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
        }
        
        .nav-brand {
            display: flex;
            align-items: center;
            font-size: 1.5rem;
            font-weight: bold;
            color: #2c3e50;
            text-decoration: none;
        }
        
        .nav-brand .logo {
            font-size: 2rem;
            margin-right: 10px;
        }
        
        .nav-menu {
            display: flex;
            list-style: none;
            margin: 0;
            padding: 0;
        }
        
        .nav-item {
            margin: 0 5px;
        }
        
        .nav-link {
            display: block;
            padding: 15px 20px;
            color: #2c3e50;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s ease;
            border-radius: 8px;
            position: relative;
        }
        
        .nav-link:hover, .nav-link.active {
            background: #3498db;
            color: white;
            transform: translateY(-2px);
        }
        
        .nav-link.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 50%;
            transform: translateX(-50%);
            width: 6px;
            height: 6px;
            background: #3498db;
            border-radius: 50%;
        }
        
        /* Quick Actions Toolbar */
        .quick-actions {
            background: rgba(255, 255, 255, 0.9);
            padding: 10px 20px;
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .quick-btn {
            padding: 8px 16px;
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 20px;
            color: #495057;
            text-decoration: none;
            font-size: 0.875rem;
            transition: all 0.2s ease;
            cursor: pointer;
        }
        
        .quick-btn:hover {
            background: #e9ecef;
            transform: translateY(-1px);
        }
        
        .quick-btn.primary {
            background: #007bff;
            color: white;
            border-color: #007bff;
        }
        
        .quick-btn.primary:hover {
            background: #0056b3;
        }
        
        /* Main Content Container */
        .container {
            background: white;
            margin: 20px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .content-wrapper {
            padding: 30px;
        }
        
        .page-section {
            display: none;
            animation: fadeIn 0.3s ease-in;
        }
        
        .page-section.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 10px;
        }
        
        .subtitle {
            text-align: center;
            color: #7f8c8d;
            margin-bottom: 30px;
            font-size: 1.1rem;
        }
        
        .section {
            margin-bottom: 30px;
            padding: 25px;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            background: #fafafa;
            transition: all 0.3s ease;
        }
        
        .section:hover {
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }
        
        .section.enhanced {
            border-left: 4px solid #27ae60;
            background: linear-gradient(135deg, #f8fff8 0%, #ffffff 100%);
        }
        
        .section.primary {
            border-left: 4px solid #3498db;
            background: linear-gradient(135deg, #f8fbff 0%, #ffffff 100%);
        }
        
        .section.enhanced h2 {
            color: #27ae60;
        }
        
        .section.primary h2 {
            color: #3498db;
        }
        
        .section.enhanced h2:before {
            content: "üß¨ ";
        }
        
        .section.primary h2:before {
            content: "‚öóÔ∏è ";
        }
        .input-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input[type="text"], input[type="number"] {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        button {
            background-color: #3498db;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background-color: #2980b9;
        }
        .result {
            background-color: #ecf0f1;
            padding: 15px;
            border-radius: 4px;
            margin-top: 15px;
            white-space: pre-wrap;
            font-family: monospace;
        }
        .error {
            background-color: #e74c3c;
            color: white;
            padding: 10px;
            border-radius: 4px;
            margin-top: 15px;
        }
        
        /* GitHub Fork Ribbon */
        .github-fork-ribbon {
            position: fixed;
            top: 0;
            right: 0;
            z-index: 9999;
            background: #333;
            color: white;
            padding: 10px 40px 10px 20px;
            text-decoration: none;
            font-size: 14px;
            font-weight: bold;
            transform: rotate(45deg) translate(25%, -50%);
            transform-origin: top right;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            transition: background 0.3s ease;
        }
        .github-fork-ribbon:hover {
            background: #2980b9;
            color: white;
        }
        
        .footer {
            text-align: center;
            margin-top: 30px;
            padding: 20px;
            border-top: 1px solid #e0e0e0;
            color: #7f8c8d;
        }
        .footer a {
            color: #3498db;
            text-decoration: none;
        }
        .footer a:hover {
            text-decoration: underline;
        }
        .compound-info {
            background: #ecf0f1;
            padding: 15px;
            margin: 10px 0;
            border-radius: 6px;
            border-left: 4px solid #3498db;
        }
        .compound-info h4 {
            margin: 0 0 10px 0;
            color: #2c3e50;
        }
        .property {
            margin: 5px 0;
            font-size: 14px;
        }
        .property strong {
            color: #2c3e50;
            display: inline-block;
            width: 120px;
        }
        .demo-tabs {
            display: flex;
            background: #f8f9fa;
            border-radius: 10px;
            padding: 5px;
            margin-bottom: 20px;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
            flex-wrap: wrap;
            gap: 5px;
        }
        .demo-tab {
            flex: 1;
            min-width: 120px;
            padding: 12px 16px;
            text-align: center;
            background: transparent;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            color: #6c757d;
            white-space: nowrap;
        }
        .demo-tab:hover {
            background: rgba(255, 255, 255, 0.7);
            color: #495057;
            transform: translateY(-1px);
        }
        .demo-tab.active {
            background: white;
            color: #007bff;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            transform: translateY(-2px);
        }
        .demo-content {
            display: none;
        }
        .demo-content.active {
            display: block;
        }
        .result.loading {
            background-color: #fff8e1;
            border-left: 4px solid #f39c12;
            color: #d68910;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .nav-container {
                flex-direction: column;
                padding: 10px;
            }
            
            .nav-menu {
                width: 100%;
                justify-content: center;
                flex-wrap: wrap;
            }
            
            .nav-link {
                padding: 10px 15px;
                font-size: 0.9rem;
            }
            
            .container {
                margin: 10px;
            }
            
            .content-wrapper {
                padding: 20px;
            }
            
            .demo-tabs {
                flex-direction: column;
                gap: 5px;
            }
            
            .demo-tab {
                min-width: auto;
                text-align: center;
            }
            
            .quick-actions {
                justify-content: center;
                padding: 10px;
            }
            
            .section {
                padding: 15px;
                margin-bottom: 20px;
            }
        }
        
        /* GitHub Fork Ribbon Enhancement */
        .github-fork-ribbon {
            position: fixed;
            top: 0;
            right: 0;
            background: #2c3e50;
            color: white;
            padding: 10px 40px;
            text-decoration: none;
            transform: rotate(45deg) translate(25%, -50%);
            transform-origin: center;
            z-index: 9999;
            font-size: 0.8rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
        }
        
        .github-fork-ribbon:hover {
            background: #34495e;
            transform: rotate(45deg) translate(25%, -50%) scale(1.1);
        }
        
        /* About Section Styling */
        .about-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .feature-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transition: transform 0.3s ease;
        }
        
        .feature-card:hover {
            transform: translateY(-5px);
        }
        
        .feature-card h3 {
            margin-top: 0;
            font-size: 1.5rem;
        }
        
        .feature-icon {
            font-size: 3rem;
            margin-bottom: 10px;
            display: block;
        }
    </style>
</head>
<body>
    <!-- Main Navigation -->
    <nav class="main-nav">
        <div class="nav-container">
            <a href="#" class="nav-brand">
                <span class="logo">üß™</span>
                CREB-JS
            </a>
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="#" class="nav-link active" onclick="showPage('core', this)">
                        ‚öóÔ∏è Core CREB
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" onclick="showPage('pubchem', this)">
                        üß¨ PubChem
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" onclick="showPage('about', this)">
                        ‚ÑπÔ∏è About
                    </a>
                </li>
            </ul>
        </div>
    </nav>

    <!-- Quick Actions Toolbar -->
    <div class="quick-actions">
        <span style="color: #6c757d; font-weight: 500;">Quick Actions:</span>
        <button class="quick-btn primary" onclick="focusElement('equation')">
            ‚öóÔ∏è Balance Equation
        </button>
        <button class="quick-btn" onclick="focusElement('cidInput'); showPage('pubchem', document.querySelector('[onclick*=pubchem]'))">
            üîç Search Compound
        </button>
        <button class="quick-btn" onclick="window.open('https://github.com/vloganathane/CREB', '_blank')">
            üìñ Documentation
        </button>
        <button class="quick-btn" onclick="clearAllResults()">
            üóëÔ∏è Clear Results
        </button>
    </div>

        <div class="container">
        <div class="content-wrapper">
            <!-- Core CREB Page -->
            <div id="core-page" class="page-section active">
                <h1>üß™ CREB-JS Demo</h1>
                <p class="subtitle">Chemical Reaction Equation Balancer - Core Features</p>

                <div class="section primary">
                    <h2>Balance Chemical Equations</h2>
                    <div class="input-group">
                        <label for="equation">Enter a chemical equation (e.g., Al + CuSO4 = Al2(SO4)3 + Cu):</label>
                        <input type="text" id="equation" placeholder="Al + CuSO4 = Al2(SO4)3 + Cu" value="Al + CuSO4 = Al2(SO4)3 + Cu">
                        <button onclick="balanceEquation()">Balance Equation</button>
                    </div>
                    <div id="result" class="result"></div>
                </div>

                <div class="section primary">
                    <h2>Calculate Stoichiometry</h2>
                    <div class="input-group">
                        <label for="stoichEquation">Balanced equation:</label>
                        <input type="text" id="stoichEquation" placeholder="2 H2 + O2 = 2 H2O" value="2 H2 + O2 = 2 H2O">
                    </div>
                    <div class="input-group">
                        <label for="species">Species:</label>
                        <input type="text" id="species" placeholder="H2" value="H2">
                    </div>
                    <div class="input-group">
                        <label for="amount">Amount (moles):</label>
                        <input type="number" id="amount" step="0.01" placeholder="1.5" value="1.5">
                        <button onclick="calculateStoichiometry()">Calculate</button>
                    </div>
                    <div id="stoichResult" class="result"></div>
                </div>

                <div class="section primary">
                    <h2>Calculate Molar Weight</h2>
                    <div class="input-group">
                        <label for="formula">Chemical formula:</label>
                        <input type="text" id="formula" placeholder="H2SO4" value="H2SO4">
                        <button onclick="calculateMolarWeight()">Calculate Molar Weight</button>
                    </div>
                    <div id="molarWeightResult" class="result"></div>
                </div>
            </div>

            <!-- PubChem Integration Page -->
            <div id="pubchem-page" class="page-section">
                <h1>üß¨ PubChem Integration</h1>
                <p class="subtitle">Enhanced Chemical Data and Analysis</p>

                <div class="section enhanced">
                    <h2>Compound Lookup</h2>
                    <div class="demo-tabs">
                        <div class="demo-tab active" onclick="switchTab('search-cid')">Search by CID</div>
                        <div class="demo-tab" onclick="switchTab('search-name')">Search by Name</div>
                        <div class="demo-tab" onclick="switchTab('search-smiles')">Search by SMILES</div>
                    </div>

                    <div id="search-cid" class="demo-content active">
                        <div class="input-group">
                            <label for="cidInput">Enter PubChem CID:</label>
                            <input type="number" id="cidInput" placeholder="2244" min="1" value="2244">
                            <button onclick="searchByCid()">Search by CID</button>
                        </div>
                    </div>

                    <div id="search-name" class="demo-content">
                        <div class="input-group">
                            <label for="nameInput">Enter compound name:</label>
                            <input type="text" id="nameInput" placeholder="aspirin" value="aspirin">
                            <button onclick="searchByName()">Search by Name</button>
                        </div>
                    </div>

                    <div id="search-smiles" class="demo-content">
                        <div class="input-group">
                            <label for="smilesInput">Enter SMILES string:</label>
                            <input type="text" id="smilesInput" placeholder="CC(=O)OC1=CC=CC=C1C(=O)O" value="CC(=O)OC1=CC=CC=C1C(=O)O">
                            <button onclick="searchBySmiles()">Search by SMILES</button>
                        </div>
                    </div>

                    <div id="compoundResult" class="result"></div>
                </div>

                <div class="section enhanced">
                    <h2>Enhanced Chemical Equation Balancer with PubChem Validation</h2>
                    <div class="input-group">
                        <label for="enhancedBalancerEquation">Chemical equation:</label>
                        <input type="text" id="enhancedBalancerEquation" placeholder="C6H12O6 + O2 = CO2 + H2O" value="C6H12O6 + O2 = CO2 + H2O">
                        <button onclick="balanceWithPubChemValidation()">Balance with PubChem Validation</button>
                    </div>
                    <div id="enhancedBalancerResult" class="result"></div>
                </div>

                <div class="section enhanced">
                    <h2>Enhanced Stoichiometry with PubChem Data</h2>
                    <div class="input-group">
                        <label for="enhancedEquation">Chemical equation:</label>
                        <input type="text" id="enhancedEquation" placeholder="C6H12O6 + O2 = CO2 + H2O" value="C6H12O6 + O2 = CO2 + H2O">
                    </div>
                    <div class="input-group">
                        <label for="enhancedSpecies">Species for calculation:</label>
                        <input type="text" id="enhancedSpecies" placeholder="C6H12O6" value="C6H12O6">
                    </div>
                    <div class="input-group">
                        <label for="enhancedAmount">Amount (moles):</label>
                        <input type="number" id="enhancedAmount" step="0.01" placeholder="1.0" value="1.0">
                        <button onclick="calculateEnhancedStoichiometry()">Calculate with PubChem Data</button>
                    </div>
                    <div id="enhancedStoichResult" class="result"></div>
                </div>

                <div class="section enhanced">
                    <h2>Compound Comparison</h2>
                    <div class="input-group">
                        <label for="compound1">First compound (name or CID):</label>
                        <input type="text" id="compound1" placeholder="glucose" value="glucose">
                    </div>
                    <div class="input-group">
                        <label for="compound2">Second compound (name or CID):</label>
                        <input type="text" id="compound2" placeholder="fructose" value="fructose">
                        <button onclick="compareCompounds()">Compare Compounds</button>
                    </div>
                    <div id="comparisonResult" class="result"></div>
                </div>
            </div>
            </div>

            <!-- About Page -->
            <div id="about-page" class="page-section">
                <h1>‚ÑπÔ∏è About CREB-JS</h1>
                <p class="subtitle">Chemical Reaction Equation Balancer with Advanced Features</p>

                <div class="section">
                    <h2>Project Overview</h2>
                    <p>CREB-JS is a comprehensive chemical equation balancer and stoichiometry calculator, enhanced with real chemical data from the PubChem database. This project combines robust equation balancing algorithms with modern web technologies to provide an intuitive chemical computation toolkit.</p>
                </div>

                <div class="about-grid">
                    <div class="feature-card">
                        <span class="feature-icon">‚öóÔ∏è</span>
                        <h3>Equation Balancing</h3>
                        <p>Advanced algorithms to balance complex chemical equations automatically with detailed error handling and validation.</p>
                    </div>
                    
                    <div class="feature-card">
                        <span class="feature-icon">üßÆ</span>
                        <h3>Stoichiometry</h3>
                        <p>Calculate molar relationships, convert between units, and perform comprehensive stoichiometric analysis.</p>
                    </div>
                    
                    <div class="feature-card">
                        <span class="feature-icon">üß¨</span>
                        <h3>PubChem Integration</h3>
                        <p>Access real chemical data including molecular weights, formulas, SMILES, and comprehensive compound information.</p>
                    </div>
                    
                    <div class="feature-card">
                        <span class="feature-icon">üîç</span>
                        <h3>Compound Search</h3>
                        <p>Search compounds by name, CID, SMILES, or molecular formula with intelligent matching and suggestions.</p>
                    </div>
                    
                    <div class="feature-card">
                        <span class="feature-icon">üìä</span>
                        <h3>Analysis Tools</h3>
                        <p>Compare compounds, analyze molecular properties, and perform enhanced stoichiometric calculations.</p>
                    </div>
                    
                    <div class="feature-card">
                        <span class="feature-icon">üåê</span>
                        <h3>Modern Web Stack</h3>
                        <p>Built with TypeScript, modern ES modules, comprehensive testing, and responsive design principles.</p>
                    </div>
                </div>

                <div class="section">
                    <h2>Technical Stack</h2>
                    <p><strong>Core:</strong> TypeScript, Rollup, Jest</p>
                    <p><strong>Integration:</strong> PubChem REST API, Modern HTTP Client</p>
                    <p><strong>Build:</strong> Multiple output formats (CJS, ESM, UMD)</p>
                    <p><strong>Testing:</strong> Comprehensive unit and integration tests</p>
                </div>
            </div>
        </div>
    </div>

    <!-- GitHub Fork Ribbon -->
    <a href="https://github.com/vloganathane/CREB" class="github-fork-ribbon" target="_blank">Fork me on GitHub</a>

    <script src="../dist/index.umd.js"></script>
    <script src="../packages/pubchem-js/dist/index.umd.js"></script>
    <script>
        // Load both CREB and PubChem libraries
        let balancer;
        
        // Initialize when the page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Add a small delay to ensure scripts are fully loaded
            setTimeout(function() {
                // Initialize core CREB functionality
                if (window.CREB && window.CREB.ChemicalEquationBalancer) {
                    balancer = new window.CREB.ChemicalEquationBalancer();
                    console.log('CREB-JS library loaded successfully!');
                } else {
                    console.error('Failed to load CREB-JS library');
                }
                
                // Check PubChem availability
                if (window.PubChemJS && window.PubChemJS.Compound) {
                    console.log('PubChem-JS library loaded successfully!');
                } else {
                    console.warn('PubChem-JS library not available - enhanced features disabled');
                    // Disable enhanced sections
                    document.querySelectorAll('.section.enhanced').forEach(section => {
                        section.style.opacity = '0.6';
                        section.style.pointerEvents = 'none';
                        const warning = document.createElement('div');
                        warning.innerHTML = '<p style="background: #fff3cd; padding: 10px; border-radius: 4px; margin-bottom: 15px;"><strong>‚ö†Ô∏è PubChem Integration Unavailable:</strong> Build the PubChem-JS package to enable enhanced features.</p>';
                        section.insertBefore(warning, section.firstChild.nextSibling);
                    });
                }
            }, 100); // 100ms delay
        });        window.balanceEquation = function() {
            const equation = document.getElementById('equation').value.trim();
            const resultDiv = document.getElementById('result');
            
            if (!window.CREB || !window.CREB.ChemicalEquationBalancer) {
                resultDiv.textContent = 'Error: CREB library not loaded';
                resultDiv.style.display = 'block';
                resultDiv.className = 'error';
                return;
            }
            
            if (!equation) {
                resultDiv.textContent = 'Error: Please enter a chemical equation';
                resultDiv.style.display = 'block';
                resultDiv.className = 'error';
                return;
            }
            
            try {
                if (!balancer) {
                    balancer = new window.CREB.ChemicalEquationBalancer();
                }
                const balanced = balancer.balance(equation);
                resultDiv.textContent = `Balanced: ${balanced}`;
                resultDiv.style.display = 'block';
                resultDiv.className = 'result';
                
                // Auto-populate stoichiometry section with balanced equation
                const stoichEquationField = document.getElementById('stoichEquation');
                const speciesField = document.getElementById('species');
                if (stoichEquationField && speciesField) {
                    stoichEquationField.value = balanced;
                    // Extract the first reactant as the default species
                    const reactants = balanced.split('=')[0].trim().split('+');
                    if (reactants.length > 0) {
                        // Remove coefficient and trim whitespace
                        const firstReactant = reactants[0].trim().replace(/^\d+\s*/, '');
                        speciesField.value = firstReactant;
                    }
                }
            } catch (error) {
                resultDiv.textContent = `Error: ${error.message}`;
                resultDiv.style.display = 'block';
                resultDiv.className = 'error';
            }
        };

        window.calculateStoichiometry = function() {
            const equation = document.getElementById('stoichEquation').value.trim();
            const species = document.getElementById('species').value.trim();
            const amount = parseFloat(document.getElementById('amount').value);
            const resultDiv = document.getElementById('stoichResult');
            
            if (!window.CREB || !window.CREB.Stoichiometry) {
                resultDiv.textContent = 'Error: CREB library not loaded';
                resultDiv.style.display = 'block';
                resultDiv.className = 'error';
                return;
            }
            
            if (!equation) {
                resultDiv.textContent = 'Error: Please enter a balanced chemical equation';
                resultDiv.style.display = 'block';
                resultDiv.className = 'error';
                return;
            }
            
            if (!species) {
                resultDiv.textContent = 'Error: Please enter a chemical species';
                resultDiv.style.display = 'block';
                resultDiv.className = 'error';
                return;
            }
            
            if (isNaN(amount) || amount <= 0) {
                resultDiv.textContent = 'Error: Please enter a valid positive amount in moles';
                resultDiv.style.display = 'block';
                resultDiv.className = 'error';
                return;
            }
            
            try {
                const stoich = new window.CREB.Stoichiometry(equation);
                const result = stoich.calculateFromMoles(species, amount);
                
                let output = `Balanced equation: ${stoich.getBalancedEquation()}\n\n`;
                output += `Reactants:\n`;
                Object.entries(result.reactants).forEach(([sp, data]) => {
                    output += `  ${sp}: ${data.moles} mol (${data.grams} g)\n`;
                });
                output += `\nProducts:\n`;
                Object.entries(result.products).forEach(([sp, data]) => {
                    output += `  ${sp}: ${data.moles} mol (${data.grams} g)\n`;
                });
                
                resultDiv.textContent = output;
                resultDiv.style.display = 'block';
                resultDiv.className = 'result';
            } catch (error) {
                resultDiv.textContent = `Error: ${error.message}`;
                resultDiv.style.display = 'block';
                resultDiv.className = 'error';
            }
        };

        window.calculateMolarWeight = function() {
            const formula = document.getElementById('formula').value.trim();
            const resultDiv = document.getElementById('molarWeightResult');
            
            if (!window.CREB) {
                resultDiv.textContent = 'Error: CREB library not loaded';
                resultDiv.style.display = 'block';
                resultDiv.className = 'error';
                return;
            }
            
            if (!formula) {
                resultDiv.textContent = 'Error: Please enter a chemical formula';
                resultDiv.style.display = 'block';
                resultDiv.className = 'error';
                return;
            }
            
            try {
                // Use the calculateMolarWeight function directly from CREB
                const molarWeight = window.CREB.calculateMolarWeight(formula);
                
                resultDiv.textContent = `Molar weight of ${formula}: ${molarWeight.toFixed(3)} g/mol`;
                resultDiv.style.display = 'block';
                resultDiv.className = 'result';
            } catch (error) {
                resultDiv.textContent = `Error: ${error.message}`;
                resultDiv.style.display = 'block';
                resultDiv.className = 'error';
            }
        };

        // Enhanced PubChem Integration Functions
        window.focusElement = function(elementId) {
            const element = document.getElementById(elementId);
            if (element) {
                element.focus();
                element.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        };

        window.showPage = function(pageId, linkElement) {
            // Hide all pages
            document.querySelectorAll('.page-section').forEach(page => {
                page.classList.remove('active');
            });
            
            // Remove active class from all nav links
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            
            // Show selected page
            document.getElementById(pageId + '-page').classList.add('active');
            
            // Add active class to clicked link
            if (linkElement) {
                linkElement.classList.add('active');
            }
        };

        window.clearAllResults = function() {
            const resultIds = [
                'result', 'stoichResult', 'molarWeightResult', 
                'compoundResult', 'enhancedStoichResult', 'comparisonResult'
            ];
            
            resultIds.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.style.display = 'none';
                    element.innerHTML = '';
                }
            });
            
            // Clear all input fields
            document.querySelectorAll('input').forEach(input => {
                if (input.type === 'text' || input.type === 'number') {
                    input.value = '';
                }
            });
        };

        window.switchTab = function(tabId) {
            // Hide all content
            document.querySelectorAll('.demo-content').forEach(content => {
                content.classList.remove('active');
            });
            document.querySelectorAll('.demo-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected content
            const targetTab = document.getElementById(tabId);
            if (targetTab) {
                targetTab.classList.add('active');
            }
            
            // Make the clicked tab active
            if (event && event.target) {
                event.target.classList.add('active');
            }
            
            // Clear any previous results
            const resultDiv = document.getElementById('compoundResult');
            if (resultDiv) {
                resultDiv.innerHTML = '';
                resultDiv.style.display = 'none';
            }
        };

        function showLoading(resultId, message = 'Searching PubChem database...') {
            const resultDiv = document.getElementById(resultId);
            resultDiv.innerHTML = `<div style="padding: 15px; background: #fff8e1; border-left: 4px solid #f39c12; color: #d68910; border-radius: 4px;">üîç ${message}</div>`;
            resultDiv.style.display = 'block';
        }

        function showError(resultId, message) {
            const resultDiv = document.getElementById(resultId);
            resultDiv.innerHTML = `<div style="padding: 15px; background: #fff5f5; border-left: 4px solid #e74c3c; color: #c0392b; border-radius: 4px;">‚ùå Error: ${message}</div>`;
            resultDiv.style.display = 'block';
        }

        function displayCompound(compound, title = '') {
            return `
                <div class="compound-info">
                    <h4>${title} CID ${compound.cid}</h4>
                    <div class="property"><strong>Formula:</strong> ${compound.molecularFormula || 'N/A'}</div>
                    <div class="property"><strong>Weight:</strong> ${compound.molecularWeight ? compound.molecularWeight.toFixed(2) + ' g/mol' : 'N/A'}</div>
                    <div class="property"><strong>SMILES:</strong> ${compound.smiles || 'N/A'}</div>
                    <div class="property"><strong>IUPAC Name:</strong> ${compound.iupacName || 'N/A'}</div>
                    <div class="property"><strong>InChI Key:</strong> ${compound.inchiKey || 'N/A'}</div>
                </div>
            `;
        }

        window.searchByCid = async function() {
            if (!window.PubChemJS || !window.PubChemJS.Compound) {
                showError('compoundResult', 'PubChem library not available');
                return;
            }
            
            const cidValue = document.getElementById('cidInput').value.trim();
            const resultId = 'compoundResult';
            
            if (!cidValue) {
                showError(resultId, 'Please enter a CID number');
                return;
            }
            
            const cid = parseInt(cidValue);
            if (isNaN(cid) || cid <= 0) {
                showError(resultId, 'Please enter a valid CID number');
                return;
            }

            showLoading(resultId);

            try {
                const compound = await window.PubChemJS.Compound.fromCid(cid);
                document.getElementById(resultId).innerHTML = 
                    `<div style="padding: 15px; background: #f8fff8; border-left: 4px solid #27ae60; border-radius: 4px;">
                        ${displayCompound(compound, 'Found:')}
                    </div>`;
                document.getElementById(resultId).style.display = 'block';
            } catch (error) {
                showError(resultId, error.message || 'Failed to fetch compound data');
            }
        };

        window.searchByName = async function() {
            if (!window.PubChemJS || !window.PubChemJS.Compound) {
                showError('compoundResult', 'PubChem library not available');
                return;
            }
            
            const nameElement = document.getElementById('nameInput');
            if (!nameElement) {
                showError('compoundResult', 'Name input field not found. Please make sure you are on the "Search by Name" tab.');
                return;
            }
            
            const name = nameElement.value.trim();
            const resultId = 'compoundResult';
            
            if (!name) {
                showError(resultId, 'Please enter a compound name');
                return;
            }

            showLoading(resultId);

            try {
                const compounds = await window.PubChemJS.Compound.fromName(name);
                
                if (compounds.length === 0) {
                    showError(resultId, 'No compounds found for this name');
                    return;
                }

                let html = `<div style="padding: 15px; background: #f8fff8; border-left: 4px solid #27ae60; border-radius: 4px;">
                    <h4>‚úÖ Found ${compounds.length} compound(s) for "${name}":</h4>`;
                
                // Show first 3 results
                const showCount = Math.min(3, compounds.length);
                for (let i = 0; i < showCount; i++) {
                    html += displayCompound(compounds[i], i === 0 ? 'Top Result:' : `Result ${i + 1}:`);
                }
                
                if (compounds.length > 3) {
                    html += `<p><em>... and ${compounds.length - 3} more results</em></p>`;
                }
                
                html += '</div>';
                document.getElementById(resultId).innerHTML = html;
                document.getElementById(resultId).style.display = 'block';
            } catch (error) {
                showError(resultId, error.message || 'Failed to search compounds');
            }
        };

        window.searchBySmiles = async function() {
            if (!window.PubChemJS || !window.PubChemJS.Compound) {
                showError('compoundResult', 'PubChem library not available');
                return;
            }
            
            const smiles = document.getElementById('smilesInput').value.trim();
            const resultId = 'compoundResult';
            
            if (!smiles) {
                showError(resultId, 'Please enter a SMILES string');
                return;
            }

            showLoading(resultId);

            try {
                const compounds = await window.PubChemJS.Compound.fromSmiles(smiles);
                
                if (compounds.length === 0) {
                    showError(resultId, 'No compounds found for this SMILES string');
                    return;
                }

                let html = `<div style="padding: 15px; background: #f8fff8; border-left: 4px solid #27ae60; border-radius: 4px;">
                    <h4>‚úÖ Found ${compounds.length} compound(s) for SMILES "${smiles}":</h4>`;
                
                // Show first 2 results
                const showCount = Math.min(2, compounds.length);
                for (let i = 0; i < showCount; i++) {
                    html += displayCompound(compounds[i], i === 0 ? 'Top Result:' : `Result ${i + 1}:`);
                }
                
                if (compounds.length > 2) {
                    html += `<p><em>... and ${compounds.length - 2} more results</em></p>`;
                }
                
                html += '</div>';
                document.getElementById(resultId).innerHTML = html;
                document.getElementById(resultId).style.display = 'block';
            } catch (error) {
                showError(resultId, error.message || 'Failed to search compounds');
            }
        };

        window.balanceWithPubChemValidation = async function() {
            if (!window.PubChemJS || !window.PubChemJS.Compound || !window.CREB || !window.CREB.EnhancedChemicalEquationBalancer) {
                showError('enhancedBalancerResult', 'Required libraries not available. Make sure both CREB and PubChem JS are loaded.');
                return;
            }
            
            const equation = document.getElementById('enhancedBalancerEquation').value.trim();
            const resultId = 'enhancedBalancerResult';
            
            if (!equation) {
                showError(resultId, 'Please enter a chemical equation');
                return;
            }
            
            showLoading(resultId, 'Balancing equation with PubChem validation...');
            
            try {
                const enhancedBalancer = new window.CREB.EnhancedChemicalEquationBalancer();
                const result = await enhancedBalancer.balanceWithPubChemData(equation);
                
                let output = `<div style="padding: 15px; background: #f8fff8; border-left: 4px solid #27ae60; border-radius: 4px;">
                    <h4>‚öñÔ∏è Enhanced Chemical Equation Balancing</h4>
                    <p><strong>Original equation:</strong> ${equation}</p>
                    <p><strong>Balanced equation:</strong> ${result.balancedEquation}</p>
                    
                    <div style="margin: 15px 0;">
                        <h5>Validation Results:</h5>
                        <div style="background: #e8f8ff; padding: 10px; border-radius: 4px;">
                            <p><strong>PubChem Validated:</strong> ${result.validation.allCompoundsFound ? '‚úÖ All compounds found' : '‚ö†Ô∏è Some compounds not found'}</p>
                            <p><strong>Formula Consistency:</strong> ${result.validation.formulaConsistency ? '‚úÖ Consistent' : '‚ùå Inconsistent'}</p>
                            <p><strong>Mass Balance:</strong> ${result.validation.massBalance ? '‚úÖ Balanced' : '‚ùå Unbalanced'}</p>
                        </div>
                    </div>`;
                
                if (result.compoundInfo && Object.keys(result.compoundInfo).length > 0) {
                    output += `<h5>Compound Information:</h5>`;
                    Object.entries(result.compoundInfo).forEach(([formula, info]) => {
                        output += `<div style="margin: 10px 0; padding: 10px; background: #ecf0f1; border-radius: 4px;">
                            <strong>${formula}:</strong><br>
                            <small>üìä PubChem CID: ${info.cid} | MW: ${info.molecularWeight?.toFixed(2)} g/mol</small><br>
                            <small>üß™ Formula: ${info.molecularFormula}</small>`;
                        if (info.synonyms && info.synonyms.length > 0) {
                            output += `<br><small>üè∑Ô∏è Names: ${info.synonyms.slice(0, 3).join(', ')}</small>`;
                        }
                        output += `</div>`;
                    });
                }
                
                if (result.suggestions && result.suggestions.length > 0) {
                    output += `<h5>Suggestions:</h5>
                        <div style="background: #fff3cd; padding: 10px; border-radius: 4px; border-left: 4px solid #ffc107;">`;
                    result.suggestions.forEach(suggestion => {
                        output += `<p>üí° ${suggestion}</p>`;
                    });
                    output += `</div>`;
                }
                
                output += `</div>`;
                document.getElementById(resultId).innerHTML = output;
                document.getElementById(resultId).style.display = 'block';
            } catch (error) {
                console.error('Enhanced balancing failed:', error);
                showError(resultId, `Balancing failed: ${error.message}`);
            }
        };

        window.calculateEnhancedStoichiometry = async function() {
            if (!window.PubChemJS || !window.PubChemJS.Compound || !window.CREB || !window.CREB.EnhancedStoichiometry) {
                showError('enhancedStoichResult', 'Required libraries not available. Make sure both CREB and PubChem JS are loaded.');
                return;
            }
            
            const equation = document.getElementById('enhancedEquation').value.trim();
            const species = document.getElementById('enhancedSpecies').value.trim();
            const amount = parseFloat(document.getElementById('enhancedAmount').value);
            const resultId = 'enhancedStoichResult';
            
            if (!equation) {
                showError(resultId, 'Please enter a chemical equation');
                return;
            }
            
            if (!species) {
                showError(resultId, 'Please enter a species for calculation');
                return;
            }
            
            if (isNaN(amount) || amount <= 0) {
                showError(resultId, 'Please enter a valid positive amount in moles');
                return;
            }
            
            showLoading(resultId, 'Calculating with PubChem data...');
            
            try {
                const enhancedStoich = new window.CREB.EnhancedStoichiometry(equation);
                const result = await enhancedStoich.calculateFromMolesEnhanced(species, amount);
                
                let output = `<div style="padding: 15px; background: #f8fff8; border-left: 4px solid #27ae60; border-radius: 4px;">
                    <h4>üß¨ Enhanced Stoichiometric Calculation</h4>
                    <p><strong>Balanced equation:</strong> ${result.balancedEquation}</p>
                    
                    <h5>Reactants:</h5>`;
                
                Object.entries(result.amounts.reactants).forEach(([sp, data]) => {
                    output += `<div style="margin: 10px 0; padding: 10px; background: #ecf0f1; border-radius: 4px;">
                        <strong>${sp}:</strong> ${data.moles.toFixed(4)} mol (${data.grams.toFixed(4)} g)`;
                    
                    if (result.compoundData[sp]) {
                        const compound = result.compoundData[sp];
                        output += `<br><small>üìä PubChem: ${compound.molecularFormula} | MW: ${compound.molecularWeight?.toFixed(2)} g/mol | CID: ${compound.cid}</small>`;
                        if (compound.synonyms && compound.synonyms.length > 0) {
                            output += `<br><small>üè∑Ô∏è Also known as: ${compound.synonyms.slice(0, 3).join(', ')}</small>`;
                        }
                    }
                    output += `</div>`;
                });
                
                output += `<h5>Products:</h5>`;
                Object.entries(result.amounts.products).forEach(([sp, data]) => {
                    output += `<div style="margin: 10px 0; padding: 10px; background: #ecf0f1; border-radius: 4px;">
                        <strong>${sp}:</strong> ${data.moles.toFixed(4)} mol (${data.grams.toFixed(4)} g)`;
                    
                    if (result.compoundData[sp]) {
                        const compound = result.compoundData[sp];
                        output += `<br><small>üìä PubChem: ${compound.molecularFormula} | MW: ${compound.molecularWeight?.toFixed(2)} g/mol | CID: ${compound.cid}</small>`;
                        if (compound.synonyms && compound.synonyms.length > 0) {
                            output += `<br><small>üè∑Ô∏è Also known as: ${compound.synonyms.slice(0, 3).join(', ')}</small>`;
                        }
                    }
                    output += `</div>`;
                });
                
                if (result.analysis) {
                    output += `<h5>Reaction Analysis:</h5>
                        <div style="margin: 10px 0; padding: 10px; background: #e8f8ff; border-radius: 4px;">
                        <p><strong>Type:</strong> ${result.analysis.reactionType}</p>
                        <p><strong>Atom Balance:</strong> ${result.analysis.atomBalance ? '‚úÖ Balanced' : '‚ùå Not balanced'}</p>
                        <p><strong>Mass Conservation:</strong> ${result.analysis.massConservation ? '‚úÖ Conserved' : '‚ùå Not conserved'}</p>
                        </div>`;
                }
                
                output += `</div>`;
                document.getElementById(resultId).innerHTML = output;
                document.getElementById(resultId).style.display = 'block';
            } catch (error) {
                console.error('Enhanced stoichiometry calculation failed:', error);
                showError(resultId, `Calculation failed: ${error.message}`);
            }
        };

        window.compareCompounds = async function() {
            if (!window.PubChemJS || !window.PubChemJS.Compound) {
                showError('comparisonResult', 'PubChem library not available');
                return;
            }
            
            const compound1Element = document.getElementById('compound1');
            const compound2Element = document.getElementById('compound2');
            
            if (!compound1Element || !compound2Element) {
                showError('comparisonResult', 'Compound input fields not found');
                return;
            }
            
            const name1 = compound1Element.value.trim();
            const name2 = compound2Element.value.trim();
            const resultId = 'comparisonResult';
            
            if (!name1 || !name2) {
                showError(resultId, 'Please enter both compound names or CIDs');
                return;
            }

            showLoading(resultId, 'Comparing compounds...');

            try {
                // Helper function to get compound (by name or CID)
                const getCompound = async (input) => {
                    const cid = parseInt(input);
                    if (!isNaN(cid)) {
                        return await window.PubChemJS.Compound.fromCid(cid);
                    } else {
                        const compounds = await window.PubChemJS.Compound.fromName(input);
                        if (compounds.length === 0) throw new Error(`No compound found for "${input}"`);
                        return compounds[0];
                    }
                };

                const [comp1, comp2] = await Promise.all([
                    getCompound(name1),
                    getCompound(name2),
                ]);

                let html = `<div style="padding: 15px; background: #f8fff8; border-left: 4px solid #27ae60; border-radius: 4px;">
                    <h4>üî¨ Compound Comparison</h4>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 15px;">
                        <div>
                            <h5>üß™ ${name1.toUpperCase()}</h5>
                            ${displayCompound(comp1).replace('class="compound-info"', 'style="background: #e8f4fd; border-left-color: #3498db;"')}
                        </div>
                        <div>
                            <h5>üß™ ${name2.toUpperCase()}</h5>
                            ${displayCompound(comp2).replace('class="compound-info"', 'style="background: #fdeee8; border-left-color: #e67e22;"')}
                        </div>
                    </div>
                    
                    <h5>‚öñÔ∏è Comparison Analysis:</h5>
                    <div style="background: #ecf0f1; padding: 10px; border-radius: 4px;">`;

                // Compare molecular weights
                const weight1 = comp1.molecularWeight;
                const weight2 = comp2.molecularWeight;
                if (weight1 && weight2) {
                    const heavier = weight1 > weight2 ? name1 : name2;
                    const ratio = (Math.abs(weight1 - weight2) / Math.min(weight1, weight2) * 100).toFixed(1);
                    html += `<p><strong>Molecular Weight:</strong> ${heavier} is heavier by ${ratio}%</p>`;
                }

                // Compare formulas
                if (comp1.molecularFormula && comp2.molecularFormula) {
                    html += `<p><strong>Formulas:</strong> ${comp1.molecularFormula} vs ${comp2.molecularFormula}</p>`;
                }

                // Compare SMILES length (structural complexity indicator)
                if (comp1.smiles && comp2.smiles) {
                    const complex = comp1.smiles.length > comp2.smiles.length ? name1 : name2;
                    html += `<p><strong>Structural Complexity:</strong> ${complex} appears more complex (longer SMILES)</p>`;
                }

                html += '</div></div>';

                document.getElementById(resultId).innerHTML = html;
                document.getElementById(resultId).style.display = 'block';
            } catch (error) {
                showError(resultId, error.message || 'Failed to compare compounds');
            }
        };
    </script>
</body>
</html>
